# autogenerated with: autogenerated with repo-creator.rb       

#################
### Functions ###
#################

rwildcard=$(foreach d,$(wildcard $(1:=/*)),$(call rwildcard,$d,$2) $(filter $(subst *,%,$2),$d))

#################
### Variables ###
#################

EXE					:= sys
EXE_SPEC			:= $(EXE).spec

CXX					:= g++
CXX_FLAGS 			:= -Wall -Wextra -std=c++17 -O3 -march=native -frename-registers -funroll-loops

SRC					:= src
INCLUDE				:= include
SPEC				:= spec
BIN					:= bin
OBJ					:= obj

MAIN				:= main
MAIN_CXX			:= $(MAIN).cxx
MAIN_OBJ			:= $(MAIN).out

INCLUDE_DIRS		:= -Iinclude
INCLUDE_DIRS_SPEC	:= $(INCLUDE_DIRS) -I$(CSPEC_INCLUDE)

STATIC_LIBS			:= 
STATIC_LIBS_SPEC	:= $(STATIC_LIBS) 

SHARED_LIBS			:= 
SHARED_LIBS_SPEC	:= $(SHARED_LIBS) -lcspec

LIBRARY_DIRS		:= 
LIBRARY_DIRS_SPEC	:= $(LIBRARY_DIRS) 

SRC_FILES			:= $(call rwildcard,$(SRC),*.cpp)
SRC_OBJ_FILES		:= $(patsubst $(SRC)/%.cpp, $(OBJ)/%.o, $(SRC_FILES))

SPEC_FILES			:= $(call rwildcard,$(SPEC),*.spec.cpp)
SPEC_OBJ_FILES		:= $(patsubst $(SPEC)/%.spec.cpp, $(OBJ)/%.spec.o, $(SPEC_FILES))

################
### Targets  ###
################

.PHONY: all
all: setup $(BIN)/$(EXE) $(BIN)/$(EXE_SPEC)

.PHONY: setup
setup: $(SRC) $(INCLUDE) $(SPEC) $(BIN) $(OBJ)

.PHONY: clean
clean:
	-rm $(BIN)/* $(OBJ)/*

.PHONY: force
force: clean all

$(BIN)/$(EXE): $(SRC_OBJ_FILES) $(OBJ)/$(MAIN_OBJ)
	$(CXX) $(CXX_FLAGS) $(LIBRARY_DIRS) $^ $(STATIC_LIBS) -o $@ $(SHARED_LIBS)

$(BIN)/$(EXE_SPEC): $(SPEC_OBJ_FILES) $(SRC_OBJ_FILES)
	$(CXX) $(CXX_FLAGS) $(LIBRARY_DIRS_SPEC) $^ $(STATIC_LIBS_SPEC) -o $@ $(SHARED_LIBS_SPEC)

$(OBJ)/$(MAIN_OBJ): $(SRC)/$(MAIN_CXX)
	$(CXX) $(CXX_FLAGS) -c $(INCLUDE_DIRS) $^ -o $(OBJ)/$(MAIN_OBJ)

$(OBJ)/%.o: $(SRC)/%.cpp
	$(CXX) $(CXX_FLAGS) -c $(INCLUDE_DIRS) $^ -o $@

$(OBJ)/%.spec.o: $(SPEC)/%.spec.cpp
	$(CXX) $(CXX_FLAGS) -c $(INCLUDE_DIRS_SPEC) $^ -o $@

$(SRC):
	@mkdir -p $@

$(INCLUDE):
	@mkdir -p $@

$(SPEC):
	@mkdir -p $@

$(BIN):
	@mkdir -p $@

$(OBJ):
	@mkdir -p $@

